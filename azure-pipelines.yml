trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

parameters:
- name: SUITE_FILE
  type: string
  default: 'MasterSuite_Regression_Application_SingleLogin.xml'
  values:
    - MasterSuite_Regression_Application_SingleLogin.xml
    - MasterSuite_Sanity_GuaranteedIssue_MulLogins.xml
    # Add other suite file options here...

stages:
- stage: Clean
  displayName: 'Clean Workspace'
  jobs:
  - job: CleanWorkspace
    displayName: 'Clean Workspace'
    steps:
    - script: |
        echo "Cleaning workspace..."
        rm -rf $(Pipeline.Workspace)/*
      displayName: 'Clean Workspace'

- stage: Checkout
  displayName: 'Git Checkout'
  jobs:
  - job: GitCheckout
    displayName: 'Checkout Code from GitHub'
    steps:
    - script: |
        git clone https://$(GITHUB_PAT):x-oauth-basic@github.com/CodetruAutomation/CitizensAgentPortal_Automation.git
      displayName: 'Checkout Code'

- stage: Test
  displayName: 'Run Tests'
  jobs:
  - job: MavenTest
    displayName: 'Maven Build and Test'
    steps:
    - task: JavaToolInstaller@0
      inputs:
        versionSpec: '17'

    - task: Maven@3
      inputs:
        mavenPomFile: 'pom.xml'
        goals: 'clean test'
        options: "-DsuiteXmlFile=src/test/resources/suites/citizens/$(SUITE_FILE)"
        publishJUnitResults: true
        testResultsFiles: '**/target/surefire-reports/*.xml'

    - script: |
        echo "Running additional scripts or commands..."
        if [ -f ./your_script.sh ]; then
          chmod +x ./your_script.sh
          ./your_script.sh
        else
          echo "your_script.sh not found!"
          exit 1
        fi
      displayName: 'Run Additional Shell Script'
